---
title: "assignment4"
author: "na"
date: "November 14, 2018"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r include = F}
library(tidyverse)
library(car)
library(userfriendlyscience)

lsa <- read_csv("lobster_size_abundance.csv")
lt <- read_csv("lobster_traps.csv")
```

```{r include = F}
#___________________________________part 0___________________________________#

# remove nas and expand rows with count larger than 1
lsa_filt <- lsa %>%
  filter(SIZE != -99999) %>%
  uncount(weights = COUNT) %>%
  mutate(MPA = case_when(
    SITE == 'IVEE' ~ 'y',
    SITE == 'NAPL' ~ 'y',
    SITE == 'AQUE' ~ 'n',
    SITE == 'CARP' ~ 'n',
    SITE == 'MOHK' ~ 'n'))

```




```{r}

#___________________________________part 2___________________________________#

# look at site distributions
qq_site_means <- ggplot(lsa_filt, aes(sample = SIZE)) +
  geom_qq() +
  facet_wrap(~ SITE) +
  theme_classic()
qq_site_means

box_site_means <- ggplot(lsa_filt, aes(x = SITE, y = SIZE)) +
  geom_boxplot() +
  theme_classic()
box_site_means

# convert site to factor in lsa_filt
lsa_filt$SITE <- as.factor(lsa_filt$SITE)

# find site means, variance, etc.
lsa_site_means <- lsa_filt %>%
  group_by(MPA, SITE) %>%
  summarize(
    mean_size = mean(SIZE),
    sd_size = sd(SIZE),
    var_size = var(SIZE)
  ) %>%
  arrange(MPA) %>%
  mutate(yloc = mean_size + sd_size + 2) # loc of annotation

lsa_site_means$SITE <- factor(lsa_site_means$SITE, levels = c("IVEE","NAPL","AQUE","MOHK","CARP"))


# levines test for equal variances
lsa_levine <- leveneTest(SIZE ~ SITE, data = lsa_filt)
lsa_levine

# anova with unequal variances
lsa_aov_size_site <- oneway(lsa_filt$SITE, y = lsa_filt$SIZE, posthoc = 'games-howell')
lsa_aov_size_site

#___________________plot___________________#
lsa_aov_colplt <- ggplot(lsa_site_means, aes(x = SITE, y = mean_size)) +
  geom_col(fill = "gray50", width = 0.5) +
  theme_classic() +
  geom_errorbar(aes(ymax =mean_size + sd_size, ymin = mean_size - sd_size), width = 0.1) +
  scale_y_continuous(expand = c(0,0), limits = c(0,100)) +
  labs(y=expression(Mean~lobster~carapace~length~(mm))) +
  scale_x_discrete(labels = c("Isla Vista","Naples Reef","Arroyo Quemado","Mohawk Reef", "Carpenteria")) +
  annotate("text", x = c(1,3,5), y = c(88.82993,86.1366,87.38254), label = "*") +
  xlab("\nSite")
lsa_aov_colplt

```

